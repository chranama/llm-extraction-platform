# --------- UI build stage ---------
FROM node:22-alpine AS build

WORKDIR /app

# Copy dependency manifests
COPY package*.json ./

RUN npm install

# Copy the rest of the app source
COPY . .

# ---- NEW: build-time env for Vite ----
ARG VITE_API_KEY
ARG VITE_API_BASE_URL=/api

ENV VITE_API_KEY=$VITE_API_KEY
ENV VITE_API_BASE_URL=$VITE_API_BASE_URL

# Build the production bundle (expects "build" script in package.json)
RUN npm run build

# --------- Nginx serve stage ---------
FROM nginx:1.27-alpine AS runtime

WORKDIR /usr/share/nginx/html

COPY --from=build /app/dist ./