# deploy/compose/docker-compose.eval.yml
services:
  eval:
    build:
      context: ../..
      dockerfile: eval/Dockerfile.eval
    container_name: llm_eval
    profiles: ["eval"]
    restart: "no"

    depends_on:
      api:
        condition: service_started

    volumes:
      - ../../config:/work/config:ro
      - ../../schemas:/work/schemas:ro
      - ../../data:/work/data
      - ../../eval:/work/eval

    environment:
      LLM_SERVER_BASE_URL: "http://api:8000"
      API_KEY: ${API_KEY:-}

    working_dir: /work

    # Editable reinstall so host edits apply immediately
    command: ["sh", "-lc", "pip install -e /work/eval && eval --help"]