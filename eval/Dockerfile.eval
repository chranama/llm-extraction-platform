# eval/Dockerfile.eval
FROM python:3.12-slim

# --------------------------
# System deps (keep lean)
# --------------------------
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl wget git \
  && rm -rf /var/lib/apt/lists/*

ENV PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1

WORKDIR /work

# --------------------------
# Install eval package (cache-friendly layers)
# --------------------------
# Copy metadata first so dependency resolution is cached
COPY eval/pyproject.toml ./eval/pyproject.toml

# Copy source (required for pip install .)
COPY eval/src ./eval/src

# Install as a normal package (reproducible default)
RUN pip install --no-cache-dir ./eval

# Default command is harmless; compose overrides for real runs.
CMD ["eval", "--help"]