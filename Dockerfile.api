# Dockerfile.api
FROM python:3.13-slim

# System deps
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl wget && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy project files
COPY pyproject.toml ./
# If you use uv, you can install via pip for simplicity here:
RUN pip install --no-cache-dir "uvicorn[standard]>=0.35" "fastapi>=0.116" \
    "orjson>=3.9.15" "sqlalchemy[asyncio]>=2.0" "asyncpg>=0.29" "aiosqlite>=0.20" \
    "greenlet>=3.0" "pydantic-settings>=2.0" "prometheus-client>=0.20" \
    "httpx>=0.27" "redis[hiredis]>=5.0"

# Copy app
COPY app ./app
COPY migrations ./migrations
COPY alembic.ini ./alembic.ini

# Expose internal API port
EXPOSE 8000

# Run the app
CMD ["uv", "run", "serve"]